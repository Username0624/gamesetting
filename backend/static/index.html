<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>互動式劇本系統</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .event { margin-bottom: 30px; padding: 15px; border: 1px solid #ccc; }
        button { margin-right: 10px; }
    </style>
</head>
<body>

<h1>互動式劇本系統</h1>

<div id="app"></div>

<script>
    let events = [];
    let choices = [];

    async function loadEvents() {
        const res = await fetch("/api/events");
        const data = await res.json();
        events = data.events;
        choices = new Array(events.length).fill(null);
        renderEvents();
    }

    function choose(index, option) {
        choices[index] = option;
        renderEvents();
    }

    async function submitChoices() {
        if (choices.includes(null)) {
            alert("請完成所有選項！");
            return;
        }
        const res = await fetch("/api/submit", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ choices })
        });
        const data = await res.json();
        renderEnding(data.ending);
    }

    function renderEvents() {
        const container = document.getElementById("app");
        container.innerHTML = "";

        events.forEach((ev, i) => {
            const div = document.createElement("div");
            div.className = "event";

            div.innerHTML = `
                <h3>${ev.title}</h3>
                <p>${ev.text}</p>
                <button onclick="choose(${i}, 'A')" ${choices[i] === "A" ? "style='background:pink;'" : ""}>${ev.a}</button>
                <button onclick="choose(${i}, 'B')" ${choices[i] === "B" ? "style='background:pink;'" : ""}>${ev.b}</button>
            `;

            container.appendChild(div);
        });

        const submitBtn = document.createElement("button");
        submitBtn.textContent = "送出結果";
        submitBtn.onclick = submitChoices;
        container.appendChild(submitBtn);
    }

    function renderEnding(ending) {
        const container = document.getElementById("app");
        container.innerHTML = `
            <h2>${ending.title}</h2>
            <p>${ending.text}</p>
            <button onclick="loadEvents()">重新開始</button>
        `;
    }

    loadEvents();
</script>

</body>
</html>
